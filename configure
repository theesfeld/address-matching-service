#!/usr/bin/env sh

set -eu

show_help() {
	cat <<'EOF'
Usage: ./configure [OPTIONS]

Options:
  --prefix=PATH     Installation prefix (default: /usr/local)
  --bindir=PATH     Binary installation directory (default: PREFIX/bin)
  --unitdir=PATH    systemd unit directory (default: /etc/systemd/system)
  --sysconfdir=PATH Configuration directory for env file (default: /etc/address-matching-service)
  -h, --help        Show this help message and exit
EOF
}

prefix="/usr/local"
bindir=""
unitdir="/etc/systemd/system"
sysconfdir="/etc/address-matching-service"

for arg in "$@"; do
	case "$arg" in
		--prefix=*)
			prefix="${arg#*=}"
			;;
		--bindir=*)
			bindir="${arg#*=}"
			;;
		--unitdir=*)
			unitdir="${arg#*=}"
			;;
		--sysconfdir=*)
			sysconfdir="${arg#*=}"
			;;
		-h|--help)
			show_help
			exit 0
			;;
		*)
			echo "Unknown option: $arg" >&2
			show_help
			exit 1
			;;
	esac
done

if [ -z "$bindir" ]; then
	bindir="$prefix/bin"
fi

cat > config.mk <<EOF
# Generated by ./configure
PREFIX = $prefix
BINDIR = $bindir
SYSTEMD_UNITDIR = $unitdir
SYSCONFDIR = $sysconfdir
EOF

cat <<EOF
Configured Address Matching Service
  prefix : $prefix
  bindir : $bindir
  unitdir: $unitdir
  sysconf: $sysconfdir

Run 'make' to build, then 'make install' to install.
EOF
